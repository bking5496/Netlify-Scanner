<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Stock Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* iOS camera fixes */
        #scanner video {
            object-fit: cover !important;
            width: 100% !important;
            height: 100% !important;
        }
        #scanner {
            overflow: hidden;
            border-radius: 12px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen font-sans antialiased selection:bg-indigo-100 selection:text-indigo-700">
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl shadow-slate-200 overflow-hidden relative"></div>

    <script>
        // DATABASE CONFIGURATION
        // =====================
        // Detects hosting environment: Netlify (with serverless functions) or static hosting (GitHub Pages)
        const isNetlify = window.location.hostname.includes('netlify.app') || window.location.hostname === 'localhost';
        const API_ENDPOINT = '/.netlify/functions/db';

        // Database helper functions
        const db = {
            connected: false,
            
            async callAPI(action, data = {}) {
                if (!isNetlify) return null; // Skip API calls on static hosting
                try {
                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action, data })
                    });
                    const result = await response.json();
                    if (!response.ok) {
                        console.error('API Error:', result.error);
                        return null;
                    }
                    return result;
                } catch (err) {
                    console.error('API call failed:', err);
                    return null;
                }
            },
            
            async init() {
                if (!isNetlify) {
                    console.log('Static hosting detected (GitHub Pages) - using localStorage');
                    return false;
                }
                try {
                    const result = await this.callAPI('init');
                    if (result && result.success) {
                        this.connected = true;
                        console.log('Connected to Neon DB via Netlify Functions');
                        return true;
                    }
                    return false;
                } catch (err) {
                    console.error('DB init error:', err);
                    return false;
                }
            },

            async insertStockTake(date) {
                if (!this.connected) return false;
                const result = await this.callAPI('insertStockTake', { take_date: date });
                return result && result.success;
            },
            
            async getStockScans(date) {
                if (!this.connected) return [];
                const result = await this.callAPI('getStockScans', { take_date: date });
                return result && result.success ? result.data : [];
            },
            
            async insertStockScan(scan) {
                if (!this.connected) return false;
                const result = await this.callAPI('insertStockScan', scan);
                return result && result.success;
            },
            
            async checkDuplicate(date, batchNumber, palletNumber) {
                if (!this.connected) return null;
                const result = await this.callAPI('checkDuplicate', {
                    take_date: date,
                    batch_number: batchNumber,
                    pallet_number: palletNumber
                });
                return result && result.success ? result.data : null;
            },
            
            async deleteStockScan(id) {
                if (!this.connected) return false;
                const result = await this.callAPI('deleteStockScan', { id });
                return result && result.success;
            }
        };

        // Local storage fallback
        const localStorage_db = {
            get: (key) => {
                const value = localStorage.getItem(key);
                return value ? JSON.parse(value) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            },
            delete: (key) => {
                localStorage.removeItem(key);
            },
            list: (prefix) => {
                return Object.keys(localStorage)
                    .filter(k => k.startsWith(prefix))
                    .map(k => {
                        const val = localStorage.getItem(k);
                        return val ? JSON.parse(val) : null;
                    })
                    .filter(Boolean);
            }
        };

        const clearLocalScanStorage = () => {
            Object.keys(localStorage)
                .filter(key => key.startsWith('scan:'))
                .forEach(key => localStorage.removeItem(key));
        };

        // Product Database
        let productDatabase = JSON.parse(localStorage.getItem('productDatabase') || '{}');
        
        if (Object.keys(productDatabase).length === 0) {
            productDatabase = {
                '12345': { stockCode: 'PROD-001', description: 'Widget Assembly' },
                '12346': { stockCode: 'PROD-002', description: 'Gadget Component' },
                '12347': { stockCode: 'PROD-003', description: 'Device Module' },
            };
            localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
        }

        function saveProductDatabase() {
            localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
        }

        // Generate device ID
        const DEVICE_ID = localStorage.getItem('deviceId') || (() => {
            const id = 'device_' + Math.random().toString(36).substring(2, 15);
            localStorage.setItem('deviceId', id);
            return id;
        })();

        // Get/set user name
        const getUserName = () => localStorage.getItem('userName') || '';
        const setUserName = (name) => localStorage.setItem('userName', name);
        
        // Get/set active stock take
        const getActiveStockTake = () => {
            const data = localStorage.getItem('activeStockTake');
            return data ? JSON.parse(data) : null;
        };
        const setActiveStockTake = (stockTake) => {
            localStorage.setItem('activeStockTake', JSON.stringify(stockTake));
        };
        const clearActiveStockTake = () => {
            localStorage.removeItem('activeStockTake');
        };

        class ScannerApp {
            constructor() {
                this.scans = [];
                this.scanner = null;
                this.preferredCameraId = null;
                this.isScanning = false;
                this.currentScan = null;
                this.showingCaseEntry = false;
                this.showingProductDB = false;
                this.showingSettings = false;
                this.showingStartStockTake = false;
                this.currentTakeDate = new Date().toISOString().split('T')[0];
                this.syncInterval = null;
                this.activeStockTake = getActiveStockTake();
                
                this.init();
            }

            get useNeonDB() {
                return db.connected;
            }

            async init() {
                // Try to initialize database
                await db.init();
                
                // Check if there's an active stock take for today
                if (this.activeStockTake && this.activeStockTake.date === this.currentTakeDate) {
                    // Continue with existing stock take
                    if (this.useNeonDB) {
                        await this.ensureStockTake();
                        this.startAutoSync();
                    }
                    await this.loadScans();
                } else {
                    // Show start stock take screen
                    this.showingStartStockTake = true;
                }
                
                this.render();
            }

            startNewStockTake(userName) {
                if (!userName || userName.trim() === '') {
                    alert('Please enter your name');
                    return;
                }
                
                setUserName(userName.trim());
                
                this.activeStockTake = {
                    date: this.currentTakeDate,
                    startedBy: userName.trim(),
                    startedAt: new Date().toISOString()
                };
                setActiveStockTake(this.activeStockTake);
                this.scans = [];
                if (!this.useNeonDB) {
                    clearLocalScanStorage();
                }
                
                this.showingStartStockTake = false;
                
                if (this.useNeonDB) {
                    this.ensureStockTake();
                    this.startAutoSync();
                }
                
                this.loadScans();
                this.render();
            }

            async endStockTake() {
                if (this.scans.length === 0) {
                    if (!confirm('No items scanned. End this stock take?')) return;
                    clearActiveStockTake();
                    this.activeStockTake = null;
                    this.showingStartStockTake = true;
                    this.render();
                    return;
                }
                
                // Reload to get all scans from all devices
                await this.loadScans();
                
                const exportFirst = confirm(
                    `End Stock Take\n\n` +
                    `Total items scanned: ${this.scans.length}\n` +
                    `(includes scans from all devices)\n\n` +
                    `Do you want to export the data before ending?`
                );
                
                if (exportFirst) {
                    this.exportStockCount();
                }
                
                clearActiveStockTake();
                this.activeStockTake = null;
                this.scans = [];
                this.showingStartStockTake = true;
                this.render();
            }

            async ensureStockTake() {
                if (!this.useNeonDB) return;
                await db.insertStockTake(this.currentTakeDate);
            }

            async loadScans() {
                if (this.useNeonDB) {
                    const data = await db.getStockScans(this.currentTakeDate);
                    
                    this.scans = data.map(row => ({
                        id: row.id,
                        timestamp: new Date(row.scanned_at).getTime(),
                        date: new Date(row.scanned_at).toLocaleDateString(),
                        time: new Date(row.scanned_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                        raw: row.raw_code,
                        batchNumber: row.batch_number,
                        palletNumber: row.pallet_number,
                        casesOnPallet: row.cases_on_pallet,
                        actualCases: row.actual_cases,
                        stockCode: row.stock_code,
                        description: row.description,
                        valid: true,
                        deviceId: row.device_id,
                        scannedBy: row.scanned_by || 'Unknown'
                    }));
                } else {
                    this.scans = localStorage_db.list('scan:');
                    this.scans.sort((a, b) => b.timestamp - a.timestamp);
                }
            }

            startAutoSync() {
                // Sync every 5 seconds
                this.syncInterval = setInterval(() => {
                    this.loadScans();
                    this.render();
                }, 5000);
            }

            async getPreferredCameraId() {
                if (this.preferredCameraId) return this.preferredCameraId;
                try {
                    const cameras = await Html5Qrcode.getCameras();
                    if (!cameras || cameras.length === 0) {
                        return null;
                    }
                    const backCamera = cameras.find(cam => /back|rear|environment/i.test(cam.label));
                    this.preferredCameraId = (backCamera || cameras[0]).id;
                    return this.preferredCameraId;
                } catch (err) {
                    console.warn('Camera enumeration failed', err);
                    return null;
                }
            }

            parseQRCode(code) {
                if (!/^\d{13}$/.test(code)) {
                    return {
                        valid: false,
                        raw: code,
                        error: 'Not a valid 13-digit code'
                    };
                }

                const batchNumber = code.substring(0, 5);
                const palletNumber = code.substring(7, 9);
                const cases = code.substring(10, 13);

                const productInfo = productDatabase[batchNumber] || {
                    stockCode: 'UNKNOWN',
                    description: 'Unknown Product - Add to database'
                };

                return {
                    valid: true,
                    raw: code,
                    batchNumber: batchNumber,
                    palletNumber: palletNumber,
                    casesOnPallet: parseInt(cases),
                    stockCode: productInfo.stockCode,
                    description: productInfo.description
                };
            }

            async checkDuplicate(batchNumber, palletNumber) {
                if (this.useNeonDB) {
                    return await db.checkDuplicate(this.currentTakeDate, batchNumber, palletNumber);
                } else {
                    return this.scans.find(s => 
                        s.batchNumber === batchNumber && 
                        s.palletNumber === palletNumber
                    );
                }
            }

            async startScanning() {
                this.isScanning = true;
                this.render();
                
                setTimeout(async () => {
                    try {
                        // Simplified iOS-friendly config
                        this.scanner = new Html5Qrcode("scanner", {
                            verbose: false,
                            experimentalFeatures: {
                                useBarCodeDetectorIfSupported: false
                            }
                        });
                        
                        const config = {
                            fps: 2,
                            qrbox: function(viewfinderWidth, viewfinderHeight) {
                                const minEdge = Math.min(viewfinderWidth, viewfinderHeight);
                                const size = Math.floor(minEdge * 0.7);
                                return { width: size, height: size };
                            },
                            rememberLastUsedCamera: true,
                            supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
                        };
                        
                        await this.scanner.start(
                            { facingMode: "environment" },
                            config,
                            (decodedText, decodedResult) => {
                                console.log('SCAN SUCCESS:', decodedText, decodedResult);
                                this.onScanSuccess(decodedText);
                            },
                            (errorMessage) => {
                                // Silent - no QR in frame
                            }
                        );
                        
                        // iOS Safari fix: force video element attributes
                        setTimeout(() => {
                            const videoElement = document.querySelector('#scanner video');
                            if (videoElement) {
                                videoElement.setAttribute('playsinline', '');
                                videoElement.setAttribute('webkit-playsinline', '');
                                videoElement.setAttribute('autoplay', '');
                                videoElement.muted = true;
                                videoElement.playsInline = true;
                            }
                        }, 500);
                        
                    } catch (err) {
                        console.error('Camera error:', err);
                        let errorMsg = 'Camera error: ';
                        if (err.name === 'NotAllowedError') {
                            errorMsg += 'Camera permission denied. Please allow camera access in your browser settings.';
                        } else if (err.name === 'NotFoundError') {
                            errorMsg += 'No camera found on this device.';
                        } else if (err.name === 'NotReadableError') {
                            errorMsg += 'Camera is in use by another app.';
                        } else {
                            errorMsg += err.message || err;
                        }
                        alert(errorMsg);
                        this.isScanning = false;
                        this.render();
                    }
                }, 300);
            }

            async stopScanning() {
                if (this.scanner) {
                    try {
                        await this.scanner.stop();
                    } catch (err) {
                        console.log('Stop error:', err);
                    }
                    try {
                        this.scanner.clear();
                    } catch (err) {
                        console.log('Clear error:', err);
                    }
                    this.scanner = null;
                }
                this.isScanning = false;
                this.render();
            }

            async onScanSuccess(code) {
                const cleanedCode = (code || '').trim();
                if (!cleanedCode) {
                    return;
                }
                if (navigator.vibrate) navigator.vibrate(200);
                
                this.stopScanning();
                
                const parsed = this.parseQRCode(cleanedCode);
                
                if (!parsed.valid) {
                    alert(parsed.error);
                    return;
                }

                // Check for duplicate
                const duplicate = await this.checkDuplicate(parsed.batchNumber, parsed.palletNumber);
                
                if (duplicate) {
                    const timestamp = duplicate.scanned_at || duplicate.date + ' ' + duplicate.time;
                    const scannedByName = duplicate.scanned_by || duplicate.scannedBy || 'Unknown';
                    
                    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                    
                    const rescan = confirm(
                        `⚠️ DUPLICATE SCAN DETECTED!\n\n` +
                        `Batch: ${parsed.batchNumber}\n` +
                        `Pallet: ${parsed.palletNumber}\n\n` +
                        `Previously scanned by: ${scannedByName}\n` +
                        `at ${timestamp}\n\n` +
                        `Do you want to rescan this pallet?`
                    );
                    
                    if (!rescan) {
                        return;
                    }
                }
                
                this.currentScan = parsed;
                this.showingCaseEntry = true;
                this.render();
            }

            async saveScan(parsedData, actualCases) {
                const userName = getUserName();
                if (this.useNeonDB) {
                    await db.insertStockScan({
                        take_date: this.currentTakeDate,
                        batch_number: parsedData.batchNumber,
                        pallet_number: parsedData.palletNumber,
                        cases_on_pallet: parsedData.casesOnPallet,
                        actual_cases: actualCases,
                        stock_code: parsedData.stockCode,
                        description: parsedData.description,
                        raw_code: parsedData.raw,
                        device_id: DEVICE_ID,
                        scanned_by: userName
                    });
                } else {
                    const scan = {
                        id: 'scan:' + Date.now(),
                        timestamp: Date.now(),
                        date: new Date().toLocaleDateString(),
                        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                        raw: parsedData.raw,
                        batchNumber: parsedData.batchNumber,
                        palletNumber: parsedData.palletNumber,
                        casesOnPallet: parsedData.casesOnPallet,
                        actualCases: actualCases,
                        scannedBy: userName,
                        stockCode: parsedData.stockCode,
                        description: parsedData.description,
                        valid: parsedData.valid,
                        deviceId: DEVICE_ID
                    };
                    
                    localStorage_db.set(scan.id, scan);
                }
                
                await this.loadScans();
                this.currentScan = null;
                this.showingCaseEntry = false;
                this.render();
            }

            async deleteScan(id) {
                if (this.useNeonDB) {
                    await db.deleteStockScan(id);
                } else {
                    localStorage_db.delete(id);
                }
                
                await this.loadScans();
                this.render();
            }

            submitCaseCount() {
                const input = document.getElementById('caseInput');
                const actualCases = parseInt(input.value);
                
                if (!actualCases || actualCases < 0) {
                    alert('Please enter a valid number of cases');
                    return;
                }
                
                this.saveScan(this.currentScan, actualCases);
            }

            cancelCaseEntry() {
                this.currentScan = null;
                this.showingCaseEntry = false;
                this.render();
            }

            manualEntry() {
                this.stopScanning();
                const code = prompt('Enter the 13-digit QR code manually:');
                if (code && code.trim()) {
                    this.onScanSuccess(code.trim());
                }
            }

            showProductDatabase() {
                this.showingProductDB = true;
                this.render();
            }

            hideProductDatabase() {
                this.showingProductDB = false;
                this.render();
            }

            showSettings() {
                this.showingSettings = true;
                this.render();
            }

            hideSettings() {
                this.showingSettings = false;
                this.render();
            }

            async saveSettings() {
                alert('Database credentials are configured. Use Test Connection to verify.');
            }

            async testConnection() {
                const connected = await db.init();
                
                if (connected) {
                    await this.ensureStockTake();
                    await this.loadScans();
                    if (!this.syncInterval) {
                        this.startAutoSync();
                    }
                    alert('✓ Connected to Neon DB successfully!');
                } else {
                    alert('✗ Connection failed. Check browser console for details.');
                }
                
                this.render();
            }

            addProduct() {
                const batch = prompt('Enter Batch Number (5 digits):');
                if (!batch || !/^\d{5}$/.test(batch)) {
                    alert('Invalid batch number');
                    return;
                }
                
                const stockCode = prompt('Enter Stock Code:');
                if (!stockCode) return;
                
                const description = prompt('Enter Product Description:');
                if (!description) return;
                
                productDatabase[batch] = { stockCode, description };
                saveProductDatabase();
                alert('Product added!');
                this.render();
            }

            uploadExcel() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.xlsx,.xls,.csv';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = new Uint8Array(event.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            
                            let imported = 0;
                            jsonData.forEach(row => {
                                const batch = String(row.BatchNumber || row.batchNumber || row['Batch Number'] || '').padStart(5, '0');
                                const stockCode = row.StockCode || row.stockCode || row['Stock Code'];
                                const description = row.Description || row.description;
                                
                                if (batch && stockCode && description && /^\d{5}$/.test(batch)) {
                                    productDatabase[batch] = { stockCode, description };
                                    imported++;
                                }
                            });
                            
                            saveProductDatabase();
                            alert(`Imported ${imported} products!`);
                            this.render();
                        } catch (err) {
                            alert('Error: ' + err.message);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                };
                input.click();
            }

            exportProductDatabase() {
                const data = Object.entries(productDatabase).map(([batch, info]) => ({
                    BatchNumber: batch,
                    StockCode: info.stockCode,
                    Description: info.description
                }));
                
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Products");
                XLSX.writeFile(wb, "product_database.xlsx");
            }

            exportStockCount() {
                const data = this.scans.map(scan => ({
                    'Stock Take Date': this.currentTakeDate,
                    'Scanned By': scan.scannedBy || 'Unknown',
                    'Batch Number': scan.batchNumber,
                    'Pallet Number': scan.palletNumber,
                    'Stock Code': scan.stockCode,
                    'Description': scan.description,
                    'Cases on Pallet': scan.casesOnPallet,
                    'Actual Cases': scan.actualCases,
                    'Variance': scan.actualCases - scan.casesOnPallet,
                    'Scanned At': scan.date + ' ' + scan.time,
                    'Device ID': scan.deviceId,
                    'Raw QR Code': scan.raw
                }));
                
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Stock Count");
                
                const filename = `stock_count_${this.currentTakeDate}.xlsx`;
                XLSX.writeFile(wb, filename);
            }

            clearDatabase() {
                if (!confirm('Clear entire product database?')) return;
                productDatabase = {};
                saveProductDatabase();
                alert('Database cleared');
                this.render();
            }

            render() {
                const app = document.getElementById('app');
                if (this.isScanning && document.getElementById('scanner-view')) {
                    return;
                }
                
                // Start Stock Take Screen
                if (this.showingStartStockTake) {
                    const savedName = getUserName();
                    app.innerHTML = `
                        <div class="min-h-screen flex flex-col bg-white">
                            <div class="flex-1 flex flex-col items-center justify-center p-8">
                                <div class="w-24 h-24 bg-indigo-600 rounded-3xl flex items-center justify-center mb-8 shadow-lg shadow-indigo-200 transform -rotate-6">
                                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                    </svg>
                                </div>
                                
                                <h1 class="text-3xl font-bold text-slate-900 mb-2">Stock Scanner</h1>
                                <p class="text-slate-500 mb-12 text-center">Streamline your inventory process with fast, accurate QR scanning.</p>
                                
                                <div class="w-full space-y-6">
                                    <div>
                                        <label class="block text-sm font-bold text-slate-700 mb-2 ml-1">
                                            Operator Name
                                        </label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                                </svg>
                                            </div>
                                            <input
                                                type="text"
                                                id="userNameInput"
                                                value="${savedName}"
                                                placeholder="Enter your full name"
                                                class="w-full pl-11 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-lg font-medium focus:bg-white focus:border-indigo-600 focus:ring-4 focus:ring-indigo-50/50 transition-all outline-none placeholder:text-slate-400"
                                                autocomplete="name"
                                            />
                                        </div>
                                    </div>
                                    
                                    <button 
                                        onclick="app.startNewStockTake(document.getElementById('userNameInput').value)"
                                        class="w-full bg-indigo-600 hover:bg-indigo-700 active:scale-[0.98] text-white py-4 rounded-2xl text-lg font-bold shadow-xl shadow-indigo-200 transition-all flex items-center justify-center gap-2"
                                    >
                                        <span>Start Session</span>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="p-6 text-center">
                                ${this.useNeonDB ? `
                                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 rounded-full text-xs font-bold border border-green-100">
                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span>System Online • Database Connected</span>
                                    </div>
                                ` : `
                                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-orange-50 text-orange-700 rounded-full text-xs font-bold border border-orange-100">
                                        <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                                        <span>Offline Mode • Local Storage</span>
                                    </div>
                                `}
                                <p class="text-xs text-slate-400 mt-4">v1.0.0 • ${this.currentTakeDate}</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                if (this.isScanning) {
                    app.innerHTML = `
                        <div id="scanner-view" class="fixed inset-0 bg-black z-50 flex flex-col">
                            <!-- Scanner Header -->
                            <div class="absolute top-0 left-0 right-0 z-10 p-4 flex justify-between items-start bg-gradient-to-b from-black/50 to-transparent">
                                <button onclick="app.stopScanning()" class="bg-white/20 backdrop-blur-md text-white p-3 rounded-full hover:bg-white/30 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                                <button onclick="app.manualEntry()" class="bg-white/20 backdrop-blur-md text-white px-4 py-2 rounded-full hover:bg-white/30 transition-colors text-sm font-medium">
                                    Type Code
                                </button>
                            </div>

                            <!-- Scanner Viewport -->
                            <div class="flex-1 relative overflow-hidden bg-black">
                                <div id="scanner" class="w-full h-full absolute inset-0"></div>
                                
                                <!-- Overlay Guide -->
                                <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
                                    <div class="w-64 h-64 border-2 border-white/50 rounded-3xl relative">
                                        <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-indigo-500 rounded-tl-xl -mt-1 -ml-1"></div>
                                        <div class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-indigo-500 rounded-tr-xl -mt-1 -mr-1"></div>
                                        <div class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-indigo-500 rounded-bl-xl -mb-1 -ml-1"></div>
                                        <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-indigo-500 rounded-br-xl -mb-1 -mr-1"></div>
                                        
                                        <div class="absolute top-1/2 left-0 right-0 h-0.5 bg-red-500/50 animate-pulse"></div>
                                    </div>
                                </div>
                                
                                <div class="absolute bottom-20 left-0 right-0 text-center pointer-events-none">
                                    <div class="inline-block bg-black/60 backdrop-blur-md text-white px-6 py-2 rounded-full text-sm font-medium">
                                        Align QR code within frame
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                if (this.showingCaseEntry && this.currentScan) {
                    const scan = this.currentScan;
                    app.innerHTML = `
                        <div class="min-h-screen bg-slate-50 flex flex-col">
                            <div class="flex-1 p-6 flex flex-col justify-center max-w-md mx-auto w-full">
                                <div class="bg-white rounded-3xl shadow-xl shadow-slate-200 overflow-hidden">
                                    <div class="bg-indigo-600 p-6 text-white text-center">
                                        <h2 class="text-2xl font-bold">Confirm Count</h2>
                                        <p class="text-indigo-100 text-sm mt-1">Verify the physical stock count</p>
                                    </div>
                                    
                                    <div class="p-6 space-y-6">
                                        <!-- Product Info -->
                                        <div class="text-center">
                                            <div class="inline-block bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm font-bold mb-2">
                                                ${scan.stockCode}
                                            </div>
                                            <h3 class="text-lg font-medium text-slate-900 leading-tight mb-1">${scan.description}</h3>
                                            <div class="text-sm text-slate-500">Batch: ${scan.batchNumber} • Pallet: ${scan.palletNumber}</div>
                                        </div>

                                        <!-- Count Input -->
                                        <div class="bg-slate-50 rounded-2xl p-6 border border-slate-100">
                                            <div class="flex justify-between items-center mb-4">
                                                <span class="text-sm font-bold text-slate-500 uppercase tracking-wider">Expected</span>
                                                <span class="text-2xl font-bold text-slate-400">${scan.casesOnPallet}</span>
                                            </div>
                                            
                                            <div class="relative">
                                                <label class="block text-xs font-bold text-indigo-600 uppercase tracking-wider mb-2">Actual Count</label>
                                                <input
                                                    type="number"
                                                    id="caseInput"
                                                    value="${scan.casesOnPallet}"
                                                    min="0"
                                                    class="w-full px-4 py-4 bg-white border-2 border-indigo-100 rounded-xl text-4xl font-black text-center text-indigo-900 focus:border-indigo-600 focus:ring-4 focus:ring-indigo-50 outline-none transition-all"
                                                    autofocus
                                                    onclick="this.select()"
                                                />
                                            </div>
                                        </div>
                                        
                                        <!-- Actions -->
                                        <div class="grid grid-cols-2 gap-4 pt-2">
                                            <button onclick="app.cancelCaseEntry()" class="bg-white border-2 border-slate-200 text-slate-600 hover:bg-slate-50 py-4 rounded-xl text-lg font-bold transition-colors">
                                                Cancel
                                            </button>
                                            <button onclick="app.submitCaseCount()" class="bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-xl text-lg font-bold shadow-lg shadow-indigo-200 transition-all">
                                                Confirm
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                if (this.showingProductDB) {
                    app.innerHTML = `
                        <div class="min-h-screen bg-slate-50 pb-24">
                            <div class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-20">
                                <div class="flex items-center justify-between p-4">
                                    <div>
                                        <h1 class="text-xl font-bold text-slate-900">Product Database</h1>
                                        <p class="text-sm text-slate-500">${Object.keys(productDatabase).length} products registered</p>
                                    </div>
                                    <button onclick="app.hideProductDatabase()" class="p-2 bg-slate-100 hover:bg-slate-200 rounded-full transition-colors">
                                        <svg class="w-6 h-6 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="flex gap-2 p-4 pt-0">
                                    <button onclick="app.uploadExcel()" class="flex-1 bg-indigo-50 text-indigo-600 hover:bg-indigo-100 py-2.5 px-4 rounded-xl text-sm font-bold transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                        </svg>
                                        Import Excel
                                    </button>
                                    <button onclick="app.exportProductDatabase()" class="flex-1 bg-emerald-50 text-emerald-600 hover:bg-emerald-100 py-2.5 px-4 rounded-xl text-sm font-bold transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                        </svg>
                                        Export Excel
                                    </button>
                                </div>
                            </div>
                            
                            <div class="p-4 space-y-3">
                                ${Object.keys(productDatabase).length === 0 ? `
                                    <div class="text-center py-16">
                                        <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                                            </svg>
                                        </div>
                                        <p class="text-lg font-medium text-slate-900">Database Empty</p>
                                        <p class="text-sm text-slate-500 mt-1">Import an Excel file or add products manually</p>
                                    </div>
                                ` : Object.entries(productDatabase).map(([batch, info]) => `
                                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded font-mono font-bold">
                                                ${batch}
                                            </span>
                                            <span class="text-sm font-bold text-indigo-600">${info.stockCode}</span>
                                        </div>
                                        <div class="text-slate-900 text-sm">${info.description}</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4 space-y-3 z-20">
                                <button onclick="app.addProduct()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3.5 rounded-xl text-lg font-bold shadow-lg shadow-indigo-200 transition-all">
                                    + Add Product
                                </button>
                                ${Object.keys(productDatabase).length > 0 ? `
                                    <button onclick="app.clearDatabase()" class="w-full bg-white border border-red-200 text-red-600 hover:bg-red-50 py-3 rounded-xl text-sm font-bold transition-colors">
                                        Clear Database
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    return;
                }

                if (this.showingSettings) {
                    app.innerHTML = `
                        <div class="min-h-screen bg-slate-50 p-4 flex items-center justify-center">
                            <div class="max-w-md w-full bg-white rounded-3xl shadow-xl shadow-slate-200 overflow-hidden">
                                <div class="p-6 border-b border-slate-100 flex items-center justify-between">
                                    <h2 class="text-xl font-bold text-slate-900">Settings</h2>
                                    <button onclick="app.hideSettings()" class="p-2 bg-slate-50 hover:bg-slate-100 rounded-full transition-colors">
                                        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="p-6 space-y-6">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                            Device ID
                                        </label>
                                        <div class="flex items-center gap-2 bg-slate-50 px-4 py-3 rounded-xl border border-slate-200">
                                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                            </svg>
                                            <code class="text-sm font-mono text-slate-600 flex-1">${DEVICE_ID}</code>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                            Connection Status
                                        </label>
                                        <div class="px-4 py-4 border rounded-xl ${this.useNeonDB ? 'border-emerald-200 bg-emerald-50' : 'border-amber-200 bg-amber-50'}">
                                            <div class="flex items-center gap-3">
                                                <div class="w-3 h-3 rounded-full ${this.useNeonDB ? 'bg-emerald-500' : 'bg-amber-500'}"></div>
                                                <div>
                                                    <div class="font-bold text-sm ${this.useNeonDB ? 'text-emerald-800' : 'text-amber-800'}">
                                                        ${this.useNeonDB ? 'Connected to Cloud' : 'Offline Mode'}
                                                    </div>
                                                    <div class="text-xs mt-0.5 ${this.useNeonDB ? 'text-emerald-600' : 'text-amber-600'}">
                                                        ${this.useNeonDB ? 'Data is syncing with Neon DB' : 'Data stored locally on device'}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-2 space-y-3">
                                        <button onclick="app.testConnection()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl text-sm font-bold shadow-lg shadow-indigo-100 transition-all">
                                            🔄 Test Connection
                                        </button>
                                        
                                        <button onclick="app.hideSettings()" class="w-full bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 py-3 rounded-xl text-sm font-bold transition-colors">
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Main screen
                const userName = getUserName();
                app.innerHTML = `
                    <div class="min-h-screen bg-slate-50 pb-32">
                        <!-- Sticky Header -->
                        <div class="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-slate-200 px-4 py-3 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center shadow-md shadow-indigo-200">
                                        <span class="text-white font-bold text-lg">${userName.charAt(0).toUpperCase()}</span>
                                    </div>
                                    <div>
                                        <h1 class="text-sm font-bold text-slate-900 leading-tight">Stock Take</h1>
                                        <p class="text-xs text-slate-500 font-medium">${this.currentTakeDate}</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="app.showProductDatabase()" class="p-2 text-slate-600 hover:bg-slate-100 rounded-xl transition-colors" title="Products">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/>
                                        </svg>
                                    </button>
                                    <button onclick="app.showSettings()" class="p-2 text-slate-600 hover:bg-slate-100 rounded-xl transition-colors" title="Settings">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Stats Bar -->
                        <div class="px-4 py-4">
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                                <div>
                                    <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Total Scanned</div>
                                    <div class="text-3xl font-black text-slate-900">${this.scans.length}</div>
                                </div>
                                <div class="flex gap-2">
                                    ${this.scans.length > 0 ? `
                                        <button onclick="app.exportStockCount()" class="bg-emerald-50 text-emerald-600 hover:bg-emerald-100 px-4 py-2 rounded-xl text-sm font-bold transition-colors flex items-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                            </svg>
                                            Export
                                        </button>
                                    ` : ''}
                                    <button onclick="app.endStockTake()" class="bg-slate-50 text-slate-600 hover:bg-slate-100 px-4 py-2 rounded-xl text-sm font-bold transition-colors">
                                        End
                                    </button>
                                </div>
                            </div>
                            
                            ${this.useNeonDB ? `
                                <div class="mt-3 flex items-center justify-center gap-2 text-xs font-medium text-emerald-600 bg-emerald-50/50 py-1.5 rounded-lg border border-emerald-100/50">
                                    <div class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></div>
                                    <span>Live Sync Active</span>
                                </div>
                            ` : ''}
                        </div>

                        <!-- List -->
                        <div class="px-4 space-y-3">
                            ${this.scans.length === 0 ? `
                                <div class="text-center py-20">
                                    <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <svg class="w-10 h-10 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
                                        </svg>
                                    </div>
                                    <h3 class="text-lg font-bold text-slate-900">Ready to Scan</h3>
                                    <p class="text-slate-500 mt-1">Tap the button below to start counting</p>
                                </div>
                            ` : this.scans.map(scan => `
                                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 relative overflow-hidden group">
                                    <div class="absolute top-0 left-0 w-1 h-full ${scan.actualCases !== scan.casesOnPallet ? 'bg-amber-500' : 'bg-emerald-500'}"></div>
                                    <div class="pl-3 flex items-start justify-between">
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2 mb-1">
                                                <span class="font-mono text-xs font-bold text-slate-500 bg-slate-100 px-2 py-0.5 rounded">
                                                    ${scan.batchNumber || 'N/A'}
                                                </span>
                                                <span class="text-sm font-bold text-indigo-600 truncate">${scan.stockCode}</span>
                                            </div>
                                            
                                            <div class="text-slate-900 font-medium text-sm mb-3 line-clamp-2">${scan.description}</div>
                                            
                                            <div class="flex items-center gap-3 text-xs text-slate-500 flex-wrap">
                                                <div class="flex items-center gap-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                                                    </svg>
                                                    <span>Pallet ${scan.palletNumber}</span>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                                    </svg>
                                                    <span>${scan.scannedBy || 'Unknown'}</span>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                    </svg>
                                                    <span>${scan.time}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="flex flex-col items-end gap-3 ml-3">
                                            <div class="text-right">
                                                <div class="text-2xl font-black ${scan.actualCases !== scan.casesOnPallet ? 'text-amber-600' : 'text-emerald-600'}">
                                                    ${scan.actualCases}
                                                </div>
                                                <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Cases</div>
                                            </div>
                                            
                                            <button onclick="app.deleteScan('${scan.id}')" class="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Floating Action Button -->
                        <div class="fixed bottom-6 left-4 right-4 z-40">
                            <button onclick="app.startScanning()" class="w-full bg-indigo-600 hover:bg-indigo-700 active:scale-[0.98] text-white py-4 rounded-2xl text-lg font-bold shadow-xl shadow-indigo-200 transition-all flex items-center justify-center gap-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
                                </svg>
                                <span>Scan New Item</span>
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        const app = new ScannerApp();
    </script>
</body>
</html>